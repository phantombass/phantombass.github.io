{
  "version": 3,
  "sources": ["../../server/verifier.ts"],
  "sourcesContent": ["/**\n * Verifier process\n * Pokemon Showdown - http://pokemonshowdown.com/\n *\n * This is just an asynchronous implementation of a verifier for a\n * signed key, because Node.js's crypto functions are synchronous,\n * strangely, considering how everything else is asynchronous.\n *\n * I wrote this one day hoping it would help with performance, but\n * I don't think it had any noticeable effect.\n *\n * @license MIT\n */\nimport * as crypto from 'crypto';\n\nimport { QueryProcessManager } from '../lib/process-manager';\nimport * as ConfigLoader from './config-loader';\n\nexport const PM = new QueryProcessManager<{ data: string, signature: string }, boolean>(\n\t'verifier', module, ({ data, signature }) => {\n\t\tconst verifier = crypto.createVerify(Config.loginserverkeyalgo);\n\t\tverifier.update(data);\n\t\tlet success = false;\n\t\ttry {\n\t\t\tsuccess = verifier.verify(Config.loginserverpublickey, signature, 'hex');\n\t\t} catch {}\n\n\t\treturn success;\n\t}\n);\n\nexport function verify(data: string, signature: string): Promise<boolean> {\n\treturn PM.query({ data, signature });\n}\n\nif (!PM.isParentProcess) {\n\tConfigLoader.ensureLoaded();\n\t// eslint-disable-next-line no-eval\n\tPM.startRepl((cmd: string) => eval(cmd));\n}\n\nexport function start(processCount: ConfigLoader.SubProcessesConfig) {\n\tPM.spawn(processCount['verifier'] ?? 1);\n}\n\nexport function destroy() {\n\t// No need to destroy the PM under normal circumstances.\n\t// A potential exception is graceful shutdown.\n\tvoid PM.destroy();\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA,aAAwB;AAExB,6BAAoC;AACpC,mBAA8B;AAhB9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBO,MAAM,KAAK,IAAI;AAAA,EACrB;AAAA,EAAY;AAAA,EAAQ,CAAC,EAAE,MAAM,UAAU,MAAM;AAC5C,UAAM,WAAW,OAAO,aAAa,OAAO,kBAAkB;AAC9D,aAAS,OAAO,IAAI;AACpB,QAAI,UAAU;AACd,QAAI;AACH,gBAAU,SAAS,OAAO,OAAO,sBAAsB,WAAW,KAAK;AAAA,IACxE,QAAQ;AAAA,IAAC;AAET,WAAO;AAAA,EACR;AACD;AAEO,SAAS,OAAO,MAAc,WAAqC;AACzE,SAAO,GAAG,MAAM,EAAE,MAAM,UAAU,CAAC;AACpC;AAEA,IAAI,CAAC,GAAG,iBAAiB;AACxB,eAAa,aAAa;AAE1B,KAAG,UAAU,CAAC,QAAgB,KAAK,GAAG,CAAC;AACxC;AAEO,SAAS,MAAM,cAA+C;AACpE,KAAG,MAAM,aAAa,UAAU,KAAK,CAAC;AACvC;AAEO,SAAS,UAAU;AAGzB,OAAK,GAAG,QAAQ;AACjB;",
  "names": []
}
