{
  "version": 3,
  "sources": ["../../server/index.ts"],
  "sourcesContent": ["/**\n * Main file\n * Pokemon Showdown - http://pokemonshowdown.com/\n *\n * This is the main Pokemon Showdown app, and the file that the\n * `pokemon-showdown` script runs if you start Pokemon Showdown normally.\n *\n * This file sets up our SockJS server, which handles communication\n * between users and your server, and also sets up globals. You can\n * see details in their corresponding files, but here's an overview:\n *\n * Users - from users.ts\n *\n *   Most of the communication with users happens in users.ts, we just\n *   forward messages between the sockets.js and users.ts.\n *\n *   It exports the global tables `Users.users` and `Users.connections`.\n *\n * Rooms - from rooms.ts\n *\n *   Every chat room and battle is a room, and what they do is done in\n *   rooms.ts. There's also a global room which every user is in, and\n *   handles miscellaneous things like welcoming the user.\n *\n *   It exports the global table `Rooms.rooms`.\n *\n * Dex - from sim/dex.ts\n *\n *   Handles getting data about Pokemon, items, etc.\n *\n * Ladders - from ladders.ts and ladders-remote.ts\n *\n *   Handles Elo rating tracking for players.\n *\n * Chat - from chat.ts\n *\n *   Handles chat and parses chat commands like /me and /ban\n *\n * Sockets - from sockets.js\n *\n *   Used to abstract out network connections. sockets.js handles\n *   the actual server and connection set-up.\n *\n * @license MIT\n */\ntry {\n\trequire('source-map-support').install();\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n} catch (e) {\n}\n// NOTE: This file intentionally doesn't use too many modern JavaScript\n// features, so that it doesn't crash old versions of Node.js, so we\n// can successfully print the \"We require Node.js 22+\" message.\n\n// I've gotten enough reports by people who don't use the launch\n// script that this is worth repeating here\ntry {\n// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\tfetch;\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n} catch (e) {\n\tthrow new Error(\"We require Node.js version 22 or later; you're using \" + process.version);\n}\n\ntry {\n\trequire.resolve('ts-chacha20');\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\n} catch (e) {\n\tthrow new Error(\"Dependencies are unmet; run `npm ci` before launching Pokemon Showdown again.\");\n}\n\n// Note that `import` declarations are run before any other code\nimport { Repl } from '../lib';\nimport * as ConfigLoader from './config-loader';\nimport { Sockets } from './sockets';\n\nfunction cleanupStale() {\n\treturn Repl.cleanup();\n}\n\nfunction setupGlobals() {\n\tconst { Monitor } = require('./monitor');\n\tglobal.Monitor = Monitor;\n\tglobal.__version = { head: '' };\n\tvoid Monitor.version().then((hash: any) => {\n\t\tglobal.__version.tree = hash;\n\t});\n\n\tconst { Dex } = require('../sim/dex');\n\tglobal.Dex = Dex;\n\tglobal.toID = Dex.toID;\n\n\tconst { Chat } = require('./chat');\n\tglobal.Chat = Chat;\n\n\tconst { Rooms } = require('./rooms');\n\tglobal.Rooms = Rooms;\n\t// We initialize the global room here because roomlogs.ts needs the Rooms global\n\tRooms.global = new Rooms.GlobalRoomState();\n\n\tconst { Teams } = require('../sim/teams');\n\tglobal.Teams = Teams;\n\n\tconst { LoginServer } = require('./loginserver');\n\tglobal.LoginServer = LoginServer;\n\n\tconst { Ladders } = require('./ladders');\n\tglobal.Ladders = Ladders;\n\n\tconst { Users } = require('./users');\n\tglobal.Users = Users;\n\n\tconst { Punishments } = require('./punishments');\n\tglobal.Punishments = Punishments;\n\n\tconst Verifier = require('./verifier');\n\tglobal.Verifier = Verifier;\n\n\tconst { Tournaments } = require('./tournaments');\n\tglobal.Tournaments = Tournaments;\n\n\tconst { IPTools } = require('./ip-tools');\n\tglobal.IPTools = IPTools;\n\tvoid IPTools.loadHostsAndRanges();\n\n\tconst TeamValidatorAsync = require('./team-validator-async');\n\tglobal.TeamValidatorAsync = TeamValidatorAsync;\n\n\tglobal.Sockets = Sockets;\n\tSockets.start(Config.subprocessescache);\n}\n\nexport const readyPromise = cleanupStale().then(() => {\n\tsetupGlobals();\n}).then(() => {\n\tif (Config.usesqlite) {\n\t\trequire('./modlog').start(Config.subprocessescache);\n\t}\n\n\tRooms.global.start(Config.subprocessescache);\n\tVerifier.start(Config.subprocessescache);\n\tTeamValidatorAsync.start(Config.subprocessescache);\n\tChat.start(Config.subprocessescache);\n\n\t/*********************************************************\n\t * Monitor config file and display diagnostics\n\t *********************************************************/\n\n\tif (Config.watchconfig) {\n\t\tConfigLoader.watch();\n\t}\n\n\tConfigLoader.flushLog();\n\n\t/*********************************************************\n\t * On error continue - enabled by default\n\t *********************************************************/\n\n\tif (Config.crashguard) {\n\t\t// graceful crash - allow current battles to finish before restarting\n\t\tprocess.on('uncaughtException', (err: Error) => {\n\t\t\tMonitor.crashlog(err, 'The main process');\n\t\t});\n\n\t\tprocess.on('unhandledRejection', err => {\n\t\t\t// TODO:\n\t\t\t// - Compatibility with https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode\n\t\t\t// - Crashlogger API for reporting rejections vs exceptions\n\t\t\tMonitor.crashlog(err as any, 'A main process Promise');\n\t\t});\n\t}\n\n\t/*********************************************************\n\t * Start up the REPL server\n\t *********************************************************/\n\n\tRepl.startGlobal('app');\n\n\t/*********************************************************\n\t * Fully initialized, run startup hook\n\t *********************************************************/\n\n\tif (Config.startuphook) {\n\t\tprocess.nextTick(Config.startuphook);\n\t}\n\n\tif (Config.ofemain) {\n\t\t// Create a heapdump if the process runs out of memory.\n\t\tglobal.nodeOomHeapdump = (require as any)('node-oom-heapdump')({\n\t\t\taddTimestamp: true,\n\t\t});\n\t}\n});\n"],
  "mappings": "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",
  "names": ["Monitor", "Chat", "Rooms", "Verifier", "TeamValidatorAsync"]
}
